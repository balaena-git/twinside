<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>TwinSide Admin โ ะะฐะฝะตะปั ัะฟัะฐะฒะปะตะฝะธั</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../assets/admin.css">
</head>
<body>
  <header class="admin-header">
    <h1>๐ TwinSide Admin</h1>
    <nav id="nav" class="admin-nav" style="display:none;">
      <a class="active" href="/admin/admin.html">ะะฐัะฑะพัะด</a>
      <a href="/admin/admin-pending.html">ะะฝะบะตัั</a>
      <a href="/admin/admin-users.html">ะะพะปัะทะพะฒะฐัะตะปะธ</a>
      <a href="/admin/admin-finance.html">ะคะธะฝะฐะฝัั</a>
      <a href="/admin/admin-promos.html">ะัะพะผะพะบะพะดั</a>
      <a href="/admin/admin-support.html">ะะพะดะดะตัะถะบะฐ</a>
      <a href="/admin/admin-ads.html">ะะตะบะปะฐะผะฐ</a>
    </nav>
    <button id="logout" class="btn violet" style="display:none;">ะัะนัะธ</button>
  </header>

  <main>
    <!-- ะัะพะด -->
    <section class="auth-box" id="login-box">
      <h2>ะัะพะด ะฐะดะผะธะฝะธัััะฐัะพัะฐ</h2>
      <input type="text" id="admin-email" placeholder="Email" required>
      <input type="password" id="admin-pass" placeholder="ะะฐัะพะปั" required>
      <button id="login-btn" class="btn gold full">ะะพะนัะธ</button>
      <p id="login-error" class="error-text"></p>
    </section>

    <!-- ะะฐัะฑะพัะด -->
    <section class="dashboard" id="dashboard" style="display:none;">
      <h2>๐ ะะฑัะฐั ััะฐัะธััะธะบะฐ</h2>
      <div class="cards grid-3">
        <div class="card"><h3>๐ฅ ะัะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน</h3><p id="totalUsers">โ</p></div>
        <div class="card"><h3>โก ะะฝะปะฐะนะฝ ัะตะนัะฐั</h3><p id="onlineUsers">โ</p></div>
        <div class="card"><h3>๐ ะะพะฒัั ะทะฐ ัััะบะธ</h3><p id="newToday">โ</p></div>
        <div class="card"><h3>โ ะะบัะธะฒะฝัั</h3><p id="activeUsers">โ</p></div>
        <div class="card"><h3>๐งพ ะะฝะบะตั ะฝะฐ ะฟัะพะฒะตัะบะต</h3><p id="pendingProfiles">โ</p></div>
        <div class="card"><h3>โ ะัะบะปะพะฝะตะฝะพ</h3><p id="rejectedProfiles">โ</p></div>
        <div class="card"><h3>๐ฐ ะะฑัะธะน ะฑะฐะปะฐะฝั</h3><p id="totalBalance">โ</p></div>
        <div class="card"><h3>๐ ะะพัะพะด ะทะฐ 24ั</h3><p id="income">โ</p></div>
        <div class="card"><h3>๐จ ะะฐะปะพะฑั</h3><p id="complaints">โ</p></div>
        <div class="card"><h3>๐ ะะบัะธะฒะฝัะต ะฟัะพะผะพะบะพะดั</h3><p id="promos">โ</p></div>
      </div>

      <h2>โก ะัััััะต ะดะตะนััะฒะธั</h2>
      <div class="quick-links">
        <a href="/admin/admin-pending.html" class="card link">
          <h3>๐งพ ะะฝะบะตัั</h3><p>ะะพะดะตัะฐัะธั ะฟัะพัะธะปะตะน</p>
        </a>
        <a href="/admin/admin-users.html" class="card link">
          <h3>๐ฅ ะะพะปัะทะพะฒะฐัะตะปะธ</h3><p>ะฃะฟัะฐะฒะปะตะฝะธะต ะฐะบะบะฐัะฝัะฐะผะธ</p>
        </a>
        <a href="/admin/admin-finance.html" class="card link">
          <h3>๐ฐ ะคะธะฝะฐะฝัั</h3><p>ะัะฒะพะดั ะธ ะฟะพะฟะพะปะฝะตะฝะธั</p>
        </a>
        <a href="/admin/admin-ads.html" class="card link">
          <h3>๐ข ะะตะบะปะฐะผะฐ</h3><p>ะะพะฑะฐะฒะธัั ะฑะฐะฝะฝะตัั</p>
        </a>
      </div>
    </section>
  </main>

  <footer>ยฉ TwinSide Admin 2025</footer>

  <script>
    const API = "http://localhost:3000/api/admin";
    const nav = document.getElementById("nav");
    const loginBox = document.getElementById("login-box");
    const dashboard = document.getElementById("dashboard");
    const logoutBtn = document.getElementById("logout");

    // ะัะพะฒะตัะบะฐ ัะตััะธะธ
    async function checkSession() {
      try {
        const res = await fetch(`${API}/check-session`, { credentials: "include" });
        const data = await res.json();
        if (data.ok) showDashboard();
      } catch (e) { console.warn(e); }
    }

    // ะะฒัะพัะธะทะฐัะธั
    async function loginAdmin() {
      const email = document.getElementById("admin-email").value.trim();
      const pass = document.getElementById("admin-pass").value.trim();
      const err = document.getElementById("login-error");
      err.textContent = "";

      try {
        const res = await fetch(`${API}/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ email, password: pass })
        });
        const data = await res.json();
        if (data.ok) showDashboard();
        else err.textContent = data.error || "ะัะธะฑะบะฐ ะฒัะพะดะฐ";
      } catch {
        err.textContent = "ะัะธะฑะบะฐ ัะพะตะดะธะฝะตะฝะธั ั ัะตัะฒะตัะพะผ";
      }
    }

    // ะะพะบะฐะท ะฟะฐะฝะตะปะธ
    function showDashboard() {
      loginBox.style.display = "none";
      dashboard.style.display = "block";
      logoutBtn.style.display = "inline-block";
      nav.style.display = "flex";
      loadDashboard();
    }

    // ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั ะดะฐัะฑะพัะดะฐ
    async function loadDashboard() {
      try {
        const res = await fetch(`${API}/dashboard`, { credentials: "include" });
        const data = await res.json();
        if (!data.ok) throw new Error(data.error || "ะัะธะฑะบะฐ ะทะฐะณััะทะบะธ");

        document.getElementById("totalUsers").textContent = data.users.total;
        document.getElementById("onlineUsers").textContent = data.users.online;
        document.getElementById("newToday").textContent = data.users.newToday;
        document.getElementById("activeUsers").textContent = data.users.active;
        document.getElementById("pendingProfiles").textContent = data.profiles.pending;
        document.getElementById("rejectedProfiles").textContent = data.profiles.rejected;
        document.getElementById("totalBalance").textContent = data.economy.totalBalance + " ัะตะบัะบะพะธะฝะพะฒ";
        document.getElementById("income").textContent = data.economy.income24h + " ัะตะบัะบะพะธะฝะพะฒ";
        document.getElementById("complaints").textContent = data.complaints;
        document.getElementById("promos").textContent = data.promos;
      } catch (e) {
        console.error("ะัะธะฑะบะฐ ะทะฐะณััะทะบะธ ะดะฐัะฑะพัะดะฐ:", e);
      }
    }

    // ะััะพะด
    logoutBtn.onclick = async () => {
      await fetch(`${API}/logout`, { method: "POST", credentials: "include" });
      location.reload();
    };

    document.getElementById("login-btn").onclick = loginAdmin;
    checkSession();
  </script>
</body>
</html>
